<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mapa 360 Itaipu - Debug Hotspots</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #panorama {
      width: 100%;
      height: 100vh;
    }

    .pannellum-hotspot .pnlm-hotspot-inner {
      width: 100px !important;       /* largura da área clicável */
      height: 100px !important;      /* altura da área clicável */
      min-width: 100px !important;
      min-height: 100px !important;
      border-radius: 50%;            /* mantém o círculo */
      background-color: rgba(255,0,0,0.2); /* opcional, só para ver a área */
      cursor: pointer;
    }
    /* Mini-mapa */
    #miniMapa {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 500px;
      height: 388px;
      border: 1px solid #ccc;
      overflow: hidden;
      background: url('./imgs/mapa-pti.png') no-repeat center/contain;
      z-index: 1000;
    }

    /* Marcador vermelho */
    #marker {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background:red;
      pointer-events: none;
      z-index: 1001;
    }

    /* Pontos clicáveis (transparentes, só para área de clique) */
    .ponto {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: rgba(0, 0, 255, 0.88);
      cursor: pointer;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>
  <script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
</head>
<body>
  <div id="panorama"></div>

  <div id="miniMapa">
    <!-- Marcador vermelho -->
    <div id="marker"></div>

    <!-- Pontos clicáveis -->
    <div class="ponto" data-scene="entrada" style="left:264px; top:40px;"></div>
    <div class="ponto" data-scene="edificio das aguas" style="left:60px; top:94px;"></div>
    <div class="ponto" data-scene="entrada-eventos" style="left:300px; top:100px;"></div>
    <div class="ponto" data-scene="bloco 12" style="left:310px; top:200px;"></div>
    <div class="ponto" data-scene="quiosque" style="left:265px; top:225px;"></div>
    <div class="ponto" data-scene="porta lanchonete" style="left:130px; top:220px;"></div>

  </div>

  <script>
    // Recupera a última cena visitada ou usa 'entrada' como padrão
    const ultimaCena = localStorage.getItem('ultimaCena') ||'entrada';

    const viewer = pannellum.viewer('panorama', {
      "default": {
        "firstScene": ultimaCena,
        "author": "Gustavo Neves",
        "sceneFadeDuration": 1000,
        "autoLoad": true,
        "hotSpotDebug": true,   // 👈 muda para false quando finalizar
        "hfov": 100
      },

      "scenes": {
        "entrada": {
          "title": "Ponto de Ônibus",
          "panorama": "./imgs/ponto_onibus_texto.png",
          "hotSpots": [
            {
              "pitch": -10, "yaw": 0,
              "type": "scene",
              "text": "Próxima",
              "sceneId": "onibus-aguas-eventos",
              "scale": 5.0
            }
          ]
        },

        "onibus-aguas-eventos": {
          "title": "Edifício das Águas / Espaço de Eventos",
          "panorama": "./imgs/divisao_onibus-aguas-eventos-texto.jpg",
          "yaw":40,
          "hotSpots": [
            {
              "pitch": -10, "yaw": -5,
              "type": "scene",
              "text": "Próxima",
              "sceneId": "onibus-eventos"
            },
            {
              "pitch": -10, "yaw": 85,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "blocos 8 e 9"
            },
            {
              "pitch": -10, "yaw": 180,
              "type": "scene",
              "text": "Voltar para o ponto de ônibus",
              "sceneId": "entrada"
            }
          ]
        },
        "blocos 8 e 9": {
          "panorama": "./imgs/blocos 8 9 edificios das aguas.jpg",
          "yaw":170,
          "hotSpots": [
            {
              "pitch": -10, "yaw": -8,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":-10,
              "sceneId": "onibus-aguas-eventos"
            },
            {
              "pitch": -10, "yaw": 172,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "blocos 3 e 4"
            }
          ]
        },
        "blocos 3 e 4": {
          "panorama": "./imgs/blocos 3 4 edificio das aguas.jpeg",
          "yaw":170,
          "hotSpots": [
            {
              "pitch": -10, "yaw": -8,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "blocos 8 e 9",
              "targetYaw":-10
            },
            {
              "pitch": -10, "yaw": 172,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "edificio das aguas"
            }
          ]
        },
        "edificio das aguas": {
          "panorama": "./imgs/edificio das aguas.jpeg",
          "yaw":170,
          "hfov":100,
          "hotSpots": [
            {
              "pitch": -10, "yaw": -20,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":-10,
              "targetHfov": 100,
              "sceneId": "blocos 3 e 4"
            }
          ]
        },
        

        "onibus-eventos": {
          "title": "Auditórios ou seguir",
          "panorama": "./imgs/onibus_eventos_texto.jpg",
          "yaw": 125,
          "hotSpots": [
            {
              "pitch": -5, "yaw": -7,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":170,
              "sceneId": "onibus-aguas-eventos"
            },
            {
              "pitch": -5, "yaw": 80,
              "type": "scene",
              "text": "Eventos",
              "sceneId": "entrada-eventos"
            },
            {
              "pitch": -5, "yaw": 170,
              "type": "scene",
              "text": "Próximo",
              "sceneId": "onibus-bloco7 fundos"
            }
          ]
        },
        "onibus-bloco7 fundos": {
          "title": "Auditórios ou seguir",
          "panorama": "./imgs/bloco7fundos_quiosque.jpeg",
          "yaw": 40,
          "hotSpots": [
            {
              "pitch": -5, "yaw": 0,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "corredor bloco 12 quiosque"
            },
            {
              "pitch": -5, "yaw": 80,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "fora bloco 7"
            },
            {
              "pitch": -5, "yaw": 180,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":-10,
              "sceneId": "onibus-eventos"
            }
          ]
        },
        
        "entrada-eventos": {
          "title": "Auditórios",
          "panorama": "./imgs/entrada_eventos.jpg",
          "yaw":-65,
          "hotSpots": [
            {
              "pitch": -5, "yaw": -20,
              "type": "scene",
              "text": "Seguir",
              "sceneId": ""
            },
            {
              "pitch": -5, "yaw": -80,
              "type": "scene",
              "text": "LabMaker",
              "sceneId": "entrada-florestan"
            },
            {
              "pitch": -18, "yaw": 80,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "onibus-eventos"
            }
          ]
        },
        "entrada-florestan": {
          "title": "Auditórios",
          "panorama": "./imgs/entrada_florestan.jpeg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": 0,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "divisao cesar lattes",
            },
            {
              "pitch": -18, "yaw": 180,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "entrada-eventos"
            },
            {
              "pitch": -18, "yaw": -90,
              "type": "scene",
              "text": "Florestan",
              "sceneId": "florestan"
            }

          ]
        },
        "divisao cesar lattes": {
          "title": "Auditórios",
          "yaw": 130,
          "panorama": "./imgs/corredor_cesar_lattes.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": 170,
              "type": "scene",
              "text": "Entrar",
              "sceneId": "cesar lattes"
            },
            {
              "pitch": -18, "yaw": -95,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":180,
              "sceneId": "entrada-florestan"
            },
            {
              "pitch": -20, "yaw": 85,
              "type": "scene",
              "text": "Bloco 12 - precisa editar ainda",
              "sceneId": "#"
            }

          ]
        },
        "florestan": {
          "title": "Auditórios",
          "panorama": "./imgs/florestan.jpg",
          "yaw":230,
          "hfov":800,
          "hotSpots": [
            {
              "pitch": -5, "yaw": 0,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "entrada-florestan"
            }
          ]
        },
        "cesar lattes": {
          "title": "Auditórios",
          "panorama": "./imgs/Cesar_lattes.jpeg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": 180,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "divisao cesar lattes"
            }
          ]
        },
        "corredor bloco 12 quiosque": {
          "title": "Corredor bloco 12",
          "yaw": 135,
          "hfov":300,
          "panorama": "./imgs/bloco 12 quiosque.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": -3,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":180,
              "sceneId": "onibus-bloco7 fundos"
            },
            {
              "pitch": -5, "yaw": 178,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "quiosque"
            },
            {
              "pitch": -5, "yaw": 90,
              "type": "scene",
              "text": "Bloco 12",
              "sceneId": "bloco 12"
            }
          ]
        },
        "quiosque": {
          "title": "quiosque",
          "yaw": 0,
          "panorama": "./imgs/centro quiosque.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":0,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "quiosque bloco 7"
            },
            {
              "pitch": -15, "yaw": 120,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "corredor bloco 12 quiosque",
              "targetYaw":0,
            }
          ]
        },
        "bloco 12": {
          "title": "bloco 12",
          "yaw": -180,
          "panorama": "./imgs/bloco 11 bloco 12.jpeg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": -3,
              "type": "scene",
              "text": "Bloco 11",
              "sceneId": ""
            },
            {
              "pitch": -5, "yaw": -175,
              "type": "scene",
              "text": "Bloco 12",
              "sceneId": "corredor bloco 12"
            },
            {
              "pitch": -5, "yaw": 100,
              "type": "scene",
              "text": "Sair",
              "sceneId": "corredor bloco 12 quiosque"
            }
          ]
        },
        "quiosque bloco 7": {
          "title": "bloco 7",
          "yaw": -140,
          "hvof":600,
          "panorama": "./imgs/quiosque bloco 7.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw": -3,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "quiosque",
              "targetYaw":120,
            },
            {
              "pitch": -20, "yaw": -95,
              "type": "scene",
              "text": "Bloco 7",
              "sceneId": "bloco 7"
            },
            {
              "pitch": -10, "yaw": -185,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "quiosque biblioteca lanchonete"
            }
          ]
        },
        "bloco 7": {
          "title": "bloco 7",
          "yaw": -170,
          "panorama": "./imgs/bloco 7 fundos.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":-10,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "quiosque bloco 7"
            },
            {
              "pitch": -5, "yaw": -178,
              "type": "scene",
              "text": "Próximo",
              "sceneId": "bloco 7 2"
            }
          ]
        },
        "bloco 7 2": {
          "title": "Bloco 7",
          "yaw": -170,
          "panorama": "./imgs/Bloco7.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":0,
              "type": "scene",
              "text": "Voltar",
              "sceneId": "bloco 7",
              "targetYaw":0,
            },
            {
              "pitch": -5, "yaw": -178,
              "type": "scene",
              "text": "Sair",
              "sceneId": "fora bloco 7"
            }
          ]
        },
        "fora bloco 7": {
          "title": "fora Bloco 7",
          "yaw": 10,
          "panorama": "./imgs/fora bloco 7.jpg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":10,
              "type": "scene",
              "text": "Entrar",
              "sceneId": "bloco 7 2",
              "targetYaw": 0
            },
            {
              "pitch": -5, "yaw":-80,
              "type": "scene",
              "text": "Seguir",
              "sceneId": "onibus-bloco7 fundos"
            }
          ]
        },
        "quiosque biblioteca lanchonete": {
          "title": "fora Bloco 7",
          "yaw": -55,
          "hvof":100,
          "panorama": "./imgs/restaurante biblioteca.jpeg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":-10,
              "type": "scene",
              "text": "Lanchonete",
              "sceneId": "porta lanchonete"
            },
            {
              "pitch": -5, "yaw":-100,
              "type": "scene",
              "text": "Biblioteca precisa mexer",
              "sceneId": ""
            },
            {
              "pitch": -5, "yaw":-190,
              "type": "scene",
              "text": "voltar",
              "targetYaw": 0,
              "sceneId": "quiosque bloco 7"
            }

          ]
        },
        "porta lanchonete": {
          "title": "fora Bloco 7",
          "panorama": "./imgs/porta_lanchonete.jpeg",
          "hotSpots": [
            {
              "pitch": -5, "yaw":175,
              "type": "scene",
              "text": "Voltar",
              "targetYaw":180,
              "sceneId": "quiosque biblioteca lanchonete"
            }
          ]
        }


      }
    });

    // Salva a cena atual sempre que o usuário muda
    viewer.on('scenechange', function(sceneId) {
      localStorage.setItem('ultimaCena', sceneId);
      updateMarker(sceneId);
    });

    // Coordenadas dos pontos no mini-mapa
    const pontos = {
  "entrada": { x: 270, y: 47 },
  "onibus-aguas-eventos": { x: 270, y: 110 },
  "blocos 8 e 9": { x: 210, y: 104 },
  "blocos 3 e 4": { x: 125, y: 105 },
  "onibus-eventos": {x:270, y:120},
  "onibus-bloco7 fundos":{x:270, y:215},
  "corredor bloco 12 quiosque":{x:270 ,y:230},
  "quiosque bloco 7":{x:212, y:272},
  "bloco 7": {x:212, y:238},
  "bloco 7 2": {x:212, y:214},
  "fora bloco 7":{x:210,y:195},
  "edificio das aguas": { x: 67, y: 100 },
  "entrada-eventos": { x: 305, y: 106 },
  "bloco 12": { x: 316, y: 207 },
  "quiosque": { x: 270, y: 230 },
  "quiosque biblioteca lanchonete":{x:153, y:270},
  "porta lanchonete": { x: 137, y: 225 }
};

    // Atualiza o marcador vermelho
  function updateMarker(sceneId){
  const pos = pontos[sceneId];
  if(pos){
    const marker = document.getElementById("marker");
    const miniMapa = document.getElementById("miniMapa");
    const scaleX = miniMapa.offsetWidth / 500; // 500 = largura do seu mini-mapa
    const scaleY = miniMapa.offsetHeight / 388; // 380 = altura do mini-mapa

    marker.style.left = pos.x * scaleX - marker.offsetWidth/2 + "px"; 
    marker.style.top = pos.y * scaleY - marker.offsetHeight/2 + "px";
  }
}

    updateMarker(ultimaCena);

    // Clicar nos pontos para navegar
    document.querySelectorAll(".ponto").forEach(el => {
      el.addEventListener("click", () => {
        const scene = el.dataset.scene;
        viewer.loadScene(scene);
        updateMarker(scene);
      });
    });

  </script>
</body>
</html>
